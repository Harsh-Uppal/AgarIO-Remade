let playerName,docSave="";function playGame(){playerName=document.getElementById("playerName").value,clearDocAndStoreToDocSave(),playGam()}function HTP(){window.location="./howToPlay.html"}function gameEnded(){document.body.innerHTML="<div class=\"GameOverText\">Game Over</div><div class=\"highscore\">Your score : "+layer.diameter+"</div><button class=\"menuBtn\" onclick=\"menuBtnPressed()\">Go to Menu</button>",document.body.setAttribute("bgcolor","gray")}function loadScript(a){document.body.innerHTML+="<script src=\""+a+"\"></script>"}function clearDocAndStoreToDocSave(){docSave=document.body.innerHTML,document.body.innerHTML=""}function menuBtnPressed(){document.body.innerHTML=docSave,document.body.setAttribute("bgcolor","#383838")}function openCredits(){window.location="./credits.html"}var firebaseConfig={apiKey:"AIzaSyAdKvCcYJI1w49iPENMNjaNMUCL1tTFPtA",authDomain:"agar-io-93a4d.firebaseapp.com",databaseURL:"https://agar-io-93a4d-default-rtdb.firebaseio.com",projectId:"agar-io-93a4d",storageBucket:"agar-io-93a4d.appspot.com",messagingSenderId:"1032023901415",appId:"1:1032023901415:web:4355d510562924fb238e42"};firebase.initializeApp(firebaseConfig);class DatabaseFuncs{static setInOthers(){others[myID]=[playerName,[layer.position.x,layer.position.y],layer.diameter,!1]}static async updateOtherPlayers(){await database.ref("players").on("value",function(a){others=a.val()})}static async updateMyPlayer(){await database.ref("/").update({players:others})}static async loadEatables(){database.ref("eatables").on("value",a=>{eatables=a.val()})}static async loadMinEatablesInRad(){database.ref("minEatablesInRad").on("value",a=>{minEatablesInRad=a.val()})}static updateEatables(){database.ref("/").update({eatables:eatables})}static setSpawnBorder(){database.ref("spawnBorder").on("value",a=>{spawnBorder=a.val()})}static removeEatable(a){eatables.splice(a,1),database.ref("/").update({eatables:eatables})}static removeMyPlayer(){others[myID][3]=!0,this.updateMyPlayer()}static loadSpikers(){database.ref("spikers").on("value",function(a){spikers=a.val()})}}class player{constructor(a,b,c){this.position={x:a,y:b},this.speed=c/10,this.diameter=c,this.nowDiameter=c}display(){this.nowDiameter=lerp(this.nowDiameter,this.diameter,.5),fill("lime"),strokeWeight(7),ellipse(this.position.x,this.position.y,this.nowDiameter,this.nowDiameter),stroke(255),strokeWeight(1),textAlign(CENTER),textSize(30),text("You",this.position.x,this.position.y+this.diameter/2+30)}isInBorder(a,b,c){dist(0,0,this.position.x,this.position.y)>a&&("image"==b?image(c,width-90,10,80,60):"end"==b&&this.gotEaten())}gotEaten(){gameStarted=!1,gameEnded()}checkMovementKeys(){keyIsDown(65)&&(layer.position.x-=layer.speed),keyIsDown(83)&&(layer.position.y+=layer.speed),keyIsDown(68)&&(layer.position.x+=layer.speed),keyIsDown(87)&&(layer.position.y-=layer.speed)}}let layer,database,myID,warningImg,spikerImg,others=null,state="play",gameStarted=!1,noOfLines=20,startSize=50,gameLoading=!1,spawnBorder=0,lasteatableSpawned=10,eatables=null,ringRad=null,eatablesInRad=0,minEatablesInRad=null,loadingState=0,loadingSwitch=!0,lineGap=50,spikers=null;function setup(){createCanvas(0,0),database=firebase.database(),warningImg=loadImage("warning.png"),spikerImg=loadImage("spiker.png")}function playGam(){createCanvas(window.innerWidth,window.innerHeight),layer=new player(width/2,height/2,startSize),DatabaseFuncs.updateOtherPlayers(),DatabaseFuncs.setSpawnBorder(),DatabaseFuncs.loadEatables(),DatabaseFuncs.loadMinEatablesInRad(),DatabaseFuncs.loadSpikers(),gameLoading=!0}function checkSpikers(){spikers.forEach(function(a){let b=a[1]/2;image(spikerImg,a[0]-b,a[1]-b,a[2],a[2]),dist(a[0],a[1],layer.position.x,layer.position.y)<b+layer.diameter/2&&(DatabaseFuncs.removeMyPlayer(),DatabaseFuncs.updateMyPlayer(),layer.gotEaten())})}function draw(){if(background(100),eatablesInRad=0,gameLoading&&null!=others&&0!=spawnBorder&&null!=eatables&&null!=minEatablesInRad&&null!=spikers){for(let a=0;a<others.length+1;){if(a==others.length){myID=a;break}if(others[a][3]){myID=a,others[a][3]=!1;break}a++}ringRad=dist(0,0,width/2,height/2),layer.position={x:sin(random(0,1e4))*random(0,spawnBorder/2),y:cos(random(0,1e4))*random(0,spawnBorder/2)},DatabaseFuncs.updateMyPlayer(),gameLoading=!1,gameStarted=!0,draw()}return gameStarted&&null!=others&&0!=spawnBorder&&null!=eatables&&null!=minEatablesInRad&&null!=spikers?void(push(),translate(-layer.position.x+width/2,-layer.position.y+height/2),fill(100),stroke("red"),ellipse(0,0,spawnBorder,spawnBorder),pop(),layer.isInBorder(spawnBorder/2,"image",warningImg),layer.isInBorder(spawnBorder/2+200,"end"),push(),translate(-layer.position.x+width/2,-layer.position.y+height/2),drawLines(),checkPlayers(),stroke(0),layer.display(),checkEatables(),checkSpikers(),pop(),fill("orange"),textSize(20),strokeWeight(2),text("Press escape to exit",100,30),others[myID]&&others[myID][3]&&gameEnded(),DatabaseFuncs.setInOthers(),DatabaseFuncs.updateMyPlayer(),spawnEatables(),DatabaseFuncs.updateEatables(),DatabaseFuncs.loadEatables(),DatabaseFuncs.updateOtherPlayers(),DatabaseFuncs.loadSpikers(),layer.checkMovementKeys()):void showLoadingScreen()}function showLoadingScreen(){textSize(40),textAlign(CENTER),textFont("Century Gothic"),fill(255),text("Loading",width/2,height/3),loadingSwitch?(fill("green"),ellipse(width/3+loadingState,2*height/3,70,70),fill("grey"),ellipse(2*width/3,2*height/3,50,50),loadingState+=5,50>2*width/3-(width/3+loadingState)&&(loadingSwitch=!1)):(fill("green"),ellipse(width/3+loadingState,2*height/3,70,70),loadingState-=5,1>loadingState&&(loadingSwitch=!0))}function keyPressed(){27==keyCode&&(DatabaseFuncs.removeMyPlayer(),gameStarted=!1,gameEnded())}function checkEatables(){fill("cyan"),stroke("black"),strokeWeight(7),eatables.forEach((a,b)=>{ellipse(a[0],a[1],a[2]),dist(a[0],a[1],layer.position.x,layer.position.y)<ringRad&&(eatablesInRad++,dist(a[0],a[1],layer.position.x,layer.position.y)<a[2]/2+layer.diameter/2&&(layer.diameter+=a[2]/10,layer.speed*=1-a[2]/1e4,eatables.splice(b,1)))})}function checkPlayers(){fill(255),strokeWeight(7);for(let a,b=0;b<others.length;b++)a=others[b],b!=myID&&!0!=a[3]&&(stroke(0),ellipse(a[1][0],a[1][1],a[2],a[2]),dist(layer.position.x,layer.position.y,a[1][0],a[1][1])<=(a[2]+layer.diameter)/2&&(a[2]>layer.diameter?layer.gotEaten():a[2]!=layer.diameter&&(layer.diameter+=a[2]/10,layer.speed*=1-a[2]/1e4,a[3]=!0)),stroke("white"),text(a[0],a[1][0],a[1][1]+a[2]))}function spawnEatables(){if(eatablesInRad<minEatablesInRad&&0==round(random(0,1))){let a=[layer.position.x+Math.sin(random(0,360))*random(layer.diameter,layer.diameter+ringRad),layer.position.y+Math.cos(random(0,360))*random(layer.diameter,layer.diameter+ringRad),round(random(20,30))];eatables.push(a)}}function drawLines(){stroke(255);for(let a=-spawnBorder/2;a<spawnBorder/2;a+=lineGap)line(-spawnBorder/2,a,spawnBorder/2,a);for(let a=-spawnBorder/2;a<spawnBorder/2;a+=lineGap)line(a,-spawnBorder/2,a,spawnBorder/2)}